<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Binary Predicate</title>
<link rel="stylesheet" type="text/css" href="style.css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="jquery.form.js"></script>
<script type="text/javascript" src="cufon-yui.js"></script>
<script type="text/javascript" src="Arial_400-Arial_700.font.js"></script>
<script type="text/javascript" src="general.js"></script>
<script type="text/javascript" src="/ZeroClipboard.js"></script>
<script language="JavaScript">
    var clip = null;
    
    function $(id) { return document.getElementById(id); }
    
    function init() {
        ZeroClipboard.setMoviePath('http://users.soe.ucsc.edu/~khuang/research/benchmark/binary/ZeroClipboard.swf');
        clip = new ZeroClipboard.Client();
        clip.setHandCursor( true );
        
        clip.addEventListener('load', function (client) {
            alert("loaded!");
        });
        
        clip.addEventListener('mouseOver', function (client) {
            // update the text on mouse over
            clip.setText( $('box-content').value );
        });
        
        clip.addEventListener('complete', function (client, text) {
            alert("copied" + test);
        });
        
        clip.glue('d_clip_button', 'd_clip_container');
    }
    
    function debugstr(msg) {
        var p = document.createElement('p');
        p.innerHTML = msg;
        $('d_debug').appendChild(p);
    }
</script>
<style type="text/css">
    body {
        margin:0 auto;
        text-align: center;
    }
    .my_clip_button { width:150px; text-align:center; border:1px solid black; background-color:#ccc; margin:10px; padding:10px; cursor:default; font-size:9pt; }
    .my_clip_button.hover { background-color:#eee; }
    .my_clip_button.active { background-color:#aaa; }
</style>
</head>
<body onLoad="init()">
<?php
function getRandomString() {
    $length = 10;
    $characters = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    $string = '';
    for ($i = 0; $i < $length; $i++) {
        $string .= $characters[mt_rand(0, strlen($characters))];
    }
    return $string;
}

function writeLog($fileName, $content) {
    if (is_writable($fileName)) {
        if (!$handle = fopen($fileName, 'a')) {
            echo "Cannot open file ($fileName)";
            exit;
        }

        if (fwrite($handle, $content) === false) {
            echo "Cannot write to file ($fileName)";
            exit;
        }

        fclose($handle);

    } else {
        echo "The file $fileName is not writable.";
    }
}
function sec2hms ($sec, $padHours = false) {

    // start with a blank string
    $hms = "";
    
    // do the hours first: there are 3600 seconds in an hour, so if we divide
    // the total number of seconds by 3600 and throw away the remainder, we're
    // left with the number of hours in those seconds
    $hours = intval(intval($sec) / 3600); 

    // add hours to $hms (with a leading 0 if asked for)
    $hms .= ($padHours) 
          ? str_pad($hours, 2, "0", STR_PAD_LEFT). ":"
          : $hours. ":";
    
    // dividing the total seconds by 60 will give us the number of minutes
    // in total, but we're interested in *minutes past the hour* and to get
    // this, we have to divide by 60 again and then use the remainder
    $minutes = intval(($sec / 60) % 60); 

    // add minutes to $hms (with a leading 0 if needed)
    $hms .= str_pad($minutes, 2, "0", STR_PAD_LEFT). ":";

    // seconds past the minute are found by dividing the total number of seconds
    // by 60 and using the remainder
    $seconds = intval($sec % 60); 

    // add seconds to $hms (with a leading 0 if needed)
    $hms .= str_pad($seconds, 2, "0", STR_PAD_LEFT);

    // done!
    return $hms;
    
  }

// store info on server
$img = $_POST['img'];
$img1 = $_POST['img1'];
$img2 = $_POST['img2'];
$startTime = $_POST['startTime'];
$token = getRandomString();
$content = $img.",".$img1.",".$img2.",".$token.sec2hms(time(), true);
writeLog("test.txt", $content."\n");

// confirmation
echo "<br />";
echo "<br />";
echo "<br />";
echo "<br />";
echo "<br />";
//echo "<center>";
echo "<h3>";
echo "Submitted successful, thank you! <br />\n";
echo "<br />";
echo "Please use this token as your answer token: ";
echo "<font color=\"red\"><div name=\"box-content\" id=\"box-content\">".$token."</div></font><br />\n";
echo "Start time: ".gmdate("F-d-H:i:s", $startTime)."<br />\n";
echo "Now time: ".gmdate("F-d-H:i:s", time())."<br />\n";
echo "<div id=\"d_clip_container\">";
echo "<div id=\"d_clip_button\" class=\"my_clip_button\">Copy to clipboard.</div>\n";
echo "</div>";
echo "</h3>\n";
//echo "</center>";
?>
</body>
